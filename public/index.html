<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STELLA - IA Autonome Planetebeauty</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚≠ê</text></svg>">
    <style>
        :root {
            --gold: #de9f49;
            --gold-light: #f4c87c;
            --black: #121212;
            --white: #ffffff;
            --beige: #fdf8f3;
            --gray: #6b7280;
            --green: #10b981;
            --red: #ef4444;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--beige); color: var(--black); min-height: 100vh; }
        .header { background: linear-gradient(135deg, var(--black) 0%, #2d2d2d 100%); color: var(--white); padding: 1rem 1.5rem; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        .logo { display: flex; align-items: center; gap: 0.75rem; }
        .logo-icon { font-size: 1.75rem; }
        .logo-text { font-size: 1.5rem; font-weight: 700; color: var(--gold); }
        .logo-subtitle { font-size: 0.7rem; color: var(--gray); }
        .status-badge { display: flex; align-items: center; gap: 0.5rem; background: rgba(16, 185, 129, 0.2); padding: 0.5rem 1rem; border-radius: 2rem; font-size: 0.8rem; }
        .status-dot { width: 8px; height: 8px; background: var(--green); border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .capabilities { background: var(--black); padding: 0.5rem 1.5rem; display: flex; gap: 1rem; overflow-x: auto; font-size: 0.75rem; }
        .cap-item { background: rgba(222, 159, 73, 0.2); color: var(--gold); padding: 0.25rem 0.75rem; border-radius: 1rem; white-space: nowrap; }
        .container { max-width: 1000px; margin: 0 auto; padding: 1rem; }
        .card { background: var(--white); border-radius: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 1rem; overflow: hidden; }
        .card-header { background: var(--black); color: var(--white); padding: 0.875rem 1rem; display: flex; justify-content: space-between; align-items: center; }
        .card-title { font-size: 0.95rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; }
        .kpis-row { display: flex; gap: 0.5rem; padding: 1rem; flex-wrap: wrap; }
        .kpi-chip { background: var(--beige); padding: 0.5rem 1rem; border-radius: 0.5rem; text-align: center; flex: 1; min-width: 80px; }
        .kpi-label { font-size: 0.65rem; color: var(--gray); text-transform: uppercase; }
        .kpi-value { font-size: 1.25rem; font-weight: 700; }
        .kpi-value.danger { color: var(--red); }
        .kpi-value.success { color: var(--green); }
        .chat-container { display: flex; flex-direction: column; height: calc(100vh - 250px); min-height: 400px; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 0.75rem; }
        .message { max-width: 90%; padding: 0.75rem 1rem; border-radius: 1rem; font-size: 0.9rem; line-height: 1.5; }
        .message.user { background: var(--gold); color: var(--white); align-self: flex-end; border-bottom-right-radius: 0.25rem; }
        .message.assistant { background: var(--beige); color: var(--black); align-self: flex-start; border-bottom-left-radius: 0.25rem; }
        .message.system { background: #dbeafe; color: #1e40af; align-self: center; font-size: 0.8rem; padding: 0.5rem 1rem; }
        .message h2, .message h3 { font-size: 1rem; margin: 0.5rem 0; color: var(--gold); }
        .message ul { margin-left: 1.25rem; }
        .message code { background: #e5e7eb; padding: 0.125rem 0.375rem; border-radius: 0.25rem; font-size: 0.8em; }
        .message pre { background: #1f2937; color: #f3f4f6; padding: 0.75rem; border-radius: 0.5rem; overflow-x: auto; font-size: 0.8em; margin: 0.5rem 0; }
        .typing-indicator { display: flex; gap: 4px; padding: 0.75rem 1rem; background: var(--beige); border-radius: 1rem; align-self: flex-start; }
        .typing-dot { width: 8px; height: 8px; background: var(--gray); border-radius: 50%; animation: typing 1.4s infinite; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .chat-input-area { padding: 1rem; border-top: 1px solid #eee; }
        .quick-actions { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 0.75rem; }
        .quick-btn { background: var(--white); border: 1px solid var(--gold); color: var(--gold); padding: 0.375rem 0.75rem; border-radius: 2rem; font-size: 0.75rem; cursor: pointer; transition: all 0.2s; }
        .quick-btn:hover { background: var(--gold); color: var(--white); }
        .chat-input-row { display: flex; gap: 0.5rem; }
        .chat-input { flex: 1; padding: 0.875rem 1rem; border: 2px solid #e5e7eb; border-radius: 0.75rem; font-size: 1rem; outline: none; }
        .chat-input:focus { border-color: var(--gold); }
        .chat-send { background: var(--gold); color: var(--white); border: none; padding: 0.875rem 1.25rem; border-radius: 0.75rem; font-size: 1rem; font-weight: 600; cursor: pointer; }
        .chat-send:disabled { background: #ccc; cursor: not-allowed; }
        .refresh-btn { background: transparent; border: 1px solid var(--gold); color: var(--gold); padding: 0.25rem 0.5rem; border-radius: 0.375rem; font-size: 0.7rem; cursor: pointer; }
        @media (max-width: 640px) { .header { padding: 0.75rem 1rem; } .logo-text { font-size: 1.25rem; } .chat-container { height: calc(100vh - 220px); } }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <span class="logo-icon">‚≠ê</span>
            <div>
                <div class="logo-text">STELLA</div>
                <div class="logo-subtitle">IA Autonome v2.0</div>
            </div>
        </div>
        <div class="status-badge">
            <span class="status-dot"></span>
            <span>Autonome</span>
        </div>
    </header>
    <div class="capabilities">
        <span class="cap-item">üìä Shopify</span>
        <span class="cap-item">üóÑÔ∏è Supabase</span>
        <span class="cap-item">üíª GitHub</span>
        <span class="cap-item">üöÄ Deploy</span>
        <span class="cap-item">üîç Web</span>
        <span class="cap-item">üß† M√©moire</span>
    </div>
    <main class="container">
        <div class="card">
            <div class="card-header">
                <span class="card-title">üìä KPIs</span>
                <button class="refresh-btn" onclick="loadKPIs()">üîÑ</button>
            </div>
            <div class="kpis-row">
                <div class="kpi-chip"><div class="kpi-label">CA Jour</div><div class="kpi-value" id="kpi-ca">--</div></div>
                <div class="kpi-chip"><div class="kpi-label">Commandes</div><div class="kpi-value" id="kpi-cmd">--</div></div>
                <div class="kpi-chip"><div class="kpi-label">Panier</div><div class="kpi-value" id="kpi-pan">--</div></div>
                <div class="kpi-chip"><div class="kpi-label">Objectif</div><div class="kpi-value" id="kpi-prog">--%</div></div>
            </div>
        </div>
        <div class="card">
            <div class="card-header"><span class="card-title">üí¨ Chat avec STELLA</span></div>
            <div class="chat-container">
                <div class="chat-messages" id="chat-messages">
                    <div class="message system">‚≠ê STELLA v2.0 Autonome. Je peux coder, d√©ployer, modifier la BDD, chercher sur le web. Demande-moi n'importe quoi.</div>
                </div>
                <div class="chat-input-area">
                    <div class="quick-actions">
                        <button class="quick-btn" onclick="ask('Briefing du jour')">üìã Briefing</button>
                        <button class="quick-btn" onclick="ask('Liste les fichiers du projet sur GitHub')">üìÅ GitHub</button>
                        <button class="quick-btn" onclick="ask('Quelles sont les tables Supabase ?')">üóÑÔ∏è Supabase</button>
                        <button class="quick-btn" onclick="ask('Cr√©e une t√¢che: Optimiser les fiches produits')">‚úÖ T√¢che</button>
                    </div>
                    <div class="chat-input-row">
                        <input type="text" class="chat-input" id="chat-input" placeholder="Demande quelque chose √† STELLA..." onkeypress="if(event.key==='Enter')send()">
                        <button class="chat-send" id="chat-send" onclick="send()">‚Üí</button>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script>
        const API='';let sid='s-'+Date.now();
        function md(t){if(!t)return'';return t.replace(/```(\w*)\n([\s\S]*?)```/g,'<pre><code>$2</code></pre>').replace(/`([^`]+)`/g,'<code>$1</code>').replace(/^### (.*$)/gm,'<h3>$1</h3>').replace(/^## (.*$)/gm,'<h2>$1</h2>').replace(/^# (.*$)/gm,'<h1>$1</h1>').replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\*(.*?)\*/g,'<em>$1</em>').replace(/^- (.*$)/gm,'<li>$1</li>').replace(/(<li>.*<\/li>\n?)+/g,'<ul>$&</ul>').replace(/\n\n/g,'</p><p>').replace(/\n/g,'<br>');}
        async function loadKPIs(){try{const r=await fetch(API+'/kpis');const d=await r.json();const ca=parseFloat(d.ca_jour)||0;document.getElementById('kpi-ca').textContent=ca.toLocaleString('fr-FR')+'‚Ç¨';document.getElementById('kpi-ca').className='kpi-value '+(ca<1000?'danger':ca>=2000?'success':'');document.getElementById('kpi-cmd').textContent=d.nb_commandes||0;document.getElementById('kpi-pan').textContent=(d.panier_moyen||0)+'‚Ç¨';document.getElementById('kpi-prog').textContent=d.progression||'0%';}catch(e){}}
        async function send(){const i=document.getElementById('chat-input');const m=i.value.trim();if(!m)return;const b=document.getElementById('chat-messages');const btn=document.getElementById('chat-send');b.innerHTML+=`<div class="message user">${esc(m)}</div>`;i.value='';btn.disabled=true;b.innerHTML+=`<div class="typing-indicator" id="typing"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>`;b.scrollTop=b.scrollHeight;try{const r=await fetch(API+'/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:m,session_id:sid})});const d=await r.json();document.getElementById('typing')?.remove();if(d.success&&d.message){b.innerHTML+=`<div class="message assistant">${md(d.message)}</div>`;}else{b.innerHTML+=`<div class="message assistant">‚ùå ${d.error||'Erreur'}</div>`;}}catch(e){document.getElementById('typing')?.remove();b.innerHTML+=`<div class="message assistant">‚ùå Erreur connexion</div>`;}btn.disabled=false;b.scrollTop=b.scrollHeight;loadKPIs();}
        function ask(q){document.getElementById('chat-input').value=q;send();}
        function esc(t){const d=document.createElement('div');d.textContent=t;return d.innerHTML;}
        loadKPIs();setInterval(loadKPIs,5*60*1000);
    </script>
</body>
</html>
